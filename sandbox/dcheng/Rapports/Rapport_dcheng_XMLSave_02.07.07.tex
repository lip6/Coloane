\documentclass{article}

\usepackage[francais]{babel}

\title{Sauvegarde du mod\`ele - XML}
\author{David Cheng}
\date{02 Juillet 2007}

\begin{document}
\maketitle


\section{Objectifs}
L'ancienne m\'ethode de sauvegarde, une s\'erialisation du mod\`ele, ne prennait en compte les changements apport\'es \`a la suite d'une sauvegarde.
Il n'\'etait plus possible de charger le mod\`ele suite \`a une modification de Coloane.
Ainsi, un nouveau format de sauvegarde de sauvegarde a \'et\'e choisi: XML.
 
\section{Format XML}

\subsection{Pourquoi?}

Ce nouveau format de sauvegarde permet de repr\'esenter le mod\`ele sous forme de balises XML en conservant uniquement les donn\'ees n\'ecessaires \`a la reconstruction de l'objet mod\`ele.
En effet, seuls les \'el\'ements relatifs au m\'eta-mod\`ele sont stock\'es dans le fichier de sauvegarde.
De plus, cela permet de hi\'erarchiser les \'el\'ements du mod\`ele.
\subsection{Lecture du fichier de sauvegarde}
La lecture du fichier de sauvegarde est \'effectu\'ee par la m\'ethode setInput() de la classe Editor (fr.lip6.move.coloane.ui.Editor).
Cette m\'ethode est appel\'ee au chargement de Coloane, \`a l'ouverture d'un fichier de sauvegarde et \`a l'ouverture d'un mod\`ele sur Coloane.

Afin d'effectuer la lecture des fichiers de sauvegarde, l'utilisation d'un parseur XML (SAX) semble \^etre la solution la plus adapt\'ee compte tenu de la DTD que ces fichiers doivent respecter.

Avant qu'un fichier soit pars\'e, on v\'erifie s'il est conforme \`a la DTD qui se trouve dans le r\'epertoire ressources du projet coloane.
S'il est conforme, il est alors pars\'e mais si le fichier \`a charger n'est pas un fichier XML, un nouveau fichier vierge est alors cr\'e\'e. Cette mani\`ere de proc\'eder permet de contourner le fait qu'Eclipse cr\'ee des fichiers de type IFile qui une fois lue par le parseur l\'everont l'exception "MalformedByteSequenceException".

Une fois pars\'e, on obtient un mod\`ele g\'en\'erique complet.

Comment s'effectue la lecture \`a l'aide de SAX:\\

Lorsque le parseur rencontre une balise ouvrante <model>, le formalisme et la position du mod\`ele obtenus gr\^ace aux attributs de la balise, lui sont affect\'es.
S'il rencontre une balise ouvrante <node> ou <arc>, l'\'el\'ement Node ou Arc est cr\'e\'e et ajout\'e au mod\`ele.
Sinon, si la balises ouvrante est autre que <nodes> et <arcs> (qui d\'elimitent les \'el\'ements node et arc) alors un \'el\'ement Attribut est cr\'e\'e.
Cette gestion de balises est effectu\'ee dans XmlEditor.



\subsection{Ecriture du fichier de sauvegarde}
L'\'ecriture du fichier de sauvegarde est \'effectu\'ee par les m\'ethodes doSave() et doSaveAs() de la classe Editor (fr.lip6.move.coloane.ui.Editor).
Ces m\'ethodes sont appel\'ees lorsque qu'on souhaite sauvegarder un mod\`ele.

Afin d'effectuer l'\'ecriture d'un fichier de sauvegarde, diff\'erentes m\'ethodes de conversion d'\'el\'ement du mod\`ele en chaîne de caract\`eres au format xml sont invoqu\'ees.
Ces m\'ethodes se trouvent dans la classe XmlEditor (fr.lip6.move.coloane.ui.XmlEditor).

Ainsi, nous obtenons une chaine de caract\`eres repr\'esentant le mod\`ele traduit en langage XML.
L'\'ecriture du fichier peut alors s'effectuer en lisant cette chaîne.

\section{Avantages,D\'esanvantages}

La sauvegarde des mod\`eles au format XML permet que le fichier de sauvegarde ne soit li\'e qu'au m\'eta-mod\`ele, ainsi, seule une modification du m\'eta-mod\`ele pourrait entrainer une erreur au chargement du fichier.
En effet, les \'el\'ements XML ne repr\'esentent que les \'el\'ements du m\'eta-mod\`ele, n\'ecessaire \`a la reconstruction de celui-ci.

L'ancienne m\'ethode de sauvegarde n'\'etait pas adapt\'ee car une simple modification dans ModelImplAdapter entrainait une erreur au chargement d'anciens fichiers de sauvegarde et de plus, sauvegardait des donn\'ees inutiles.

Avec cette nouvelle m\'ethode de sauvegarde, chaque fichier doit \^etre construit de la m\^eme mani\`ere afin d'\^etre charg\'e, ceci est v\'erifi\'e d'une part par la DTD et par le parseur lui-m\^eme (fichier XML bien form\'e et conforme \`a la DTD).

Le principal d\'esavantage d'une sauvegarde en XML est que l'utilisateur peut \`a tout moment modifier le fichier de sauvegarde manuellement contrairement \`a l'ancienne m\'ethode.
Il faut aussi mettre \`a jouer les m\'ethodes d'\'ecritures et de lectures de la classe XmlEditor \`a chaque changement apport\'es au m\'eta-mod\`ele.


\section{Conclusion}

La m\'ethode de sauvegarde gr\^ace \`a des fichiers XML est la plus simple \`a mettre en oeuvre car il suffit d'une simple ecriture de fichier et d'un parsage SAX.
Elle permet de recharger les fichiers correctement suite \`a des modifications apport\'ees \`a Coloane (hors m\'eta-mod\`ele).
Afin d'emp\^echer une modification manuelle des fichiers, il est possible d'effectuer une s\'erialisation du contenu du fichier mais un changement dans la lecture de fichier du cot\'e de Java entraînerait la perde de tous les mod\`eles anciennement sauvegard\'es.
Il serait donc interr\'essant de trouver un moyen d'emp\^echer la modification manuelle des fichiers de sauvegarde.
\end{document}

