\documentclass{article}

\usepackage[francais]{babel}

\title{Rapport: Tests unitaires}
\author{David Cheng}
\date{30 Avril 2007}

\begin{document}
\maketitle
\section{D\'emarches}

La classe TestModel\_ID regroupe les tests d'unicit\'e des identifiants,
d'ajouts et de suppressions d'arcs et de suppression de noeuds.
Ces 3 tests ont \'et\'e regroup\'e au sein d'un m\^eme sc\'enario afin de 
simuler au mieux les actions d'un utilisateur.


\section{Sc\'enario}
\subsection{Ajout d'un arc}

L'ajout d'un arc peut \^etre possible ou non.
Il y'a donc 2 types d'ajout \`a traiter:

L'ajout de l'arc est r\'ealisable (sans prendre en compte le mod\`ele).

L'ajout de l'arc n'est pas r\'ealisable dans tous les cas.
\\

Deux m\'ethodes permettent de diff\'erencier ces cas, void switchArcOk et 
void switchArcNull:
\\

void switchArcOk(IArc arc):

\begin{itemize}
\item Ajout de deux noeuds au mod\`ele et d'un arc qui relie ces noeuds.

\item Ajout d'un arc et d'un noeud source au mod\`ele, le noeud cible 
\'etant
choisi al\'eatoirement parmi les noeuds d\'ej\`a pr\'esent dans le mod\`ele.

\item Ajout d'un arc et d'un noeud cible au mod\`ele, le noeud source 
\'etant
choisi al\'eatoirement parmi les noeuds d\'ej\`a pr\'esent dans le mod\`ele.

\item Ajout d'un arc dont noeuds source et cible sont choisis 
al\'eatoirement
parmi les noeuds d\'ej\`a pr\'esent dans le mod\`ele.
\end{itemize}


void switchArcNull(IArc arc):

\begin{itemize}
\item Ajout d'un arc dont les noeuds source et cible existent mais ne sont 
pr\'esent dans le mod\`ele

\item Ajout d'un arc dont le noeud source n'est pas pr\'esent dans le 
mod\`ele

\item Ajout d'un arc dont le noeud cible n'est pas pr\'esent dans le 
mod\`ele
\end{itemize}

A l'ajout d'un arc, il faut v\'erifier que l'arc a un noeud cible et source 
pr\'esent dans le mod\`ele.
Les listes d'arc tel que Model.listOfArc, Node.ListOfInputArcet 
Node.ListOfOutputArc
doivent \^etre mises \`a jour, c'est-\`a-dire, qu'elles doivent contenir 
l'identifiant unique de l'arc ajout\'e.

\subsection{Suppression d'un arc}

A la suppression d'un arc, les listes d'arc tel que Model.listOfArc,
Node.ListOfInputArc et Node.ListOfOutputArc doivent \^etre mises \`a jour,
c'est-\`a-dire, qu'elles ne doivent plus contenir l'identifiant unique de 
l'arc supprim\'e.

\subsection{Suppression d'un noeud}

A la suppression d'un noeud, les listes d'arc tel que Model.listOfArc du 
mod\`ele, Node.ListOfInputArc et Node.ListOfOutputArc des noeuds voisins
doivent \^etre mises \`a jour.
Si les arcs du noeud \`a supprimer sont "entrant" alors les noeuds dont ces 
arcs sont "sortant" doivent mettre \`a jour leur liste "listOfOutputArc".
Respectivement, si les arcs du noeud \`a supprimer sont "sortant"
alors les noeuds dont ces arcs sont "entrant" doivent mettre \`a jour leur 
liste "listOfInputArc".


\subsection{Sc\'enario}

Le sc\'enario est donc le suivant:
\\

Le nombre de tour est fix\'e par la variable \"max\_tour\".
Le nombre d'arc \`a supprimer est fix\'e par la variable "nb\_remove".
Al\'eatoirement, on ajoute un arc de façon correcte ou non au mod\`ele \`a 
chaque tour sauf au tour où l'on supprime nb\_remove-arcs ou un noeud.
Tous les 8 tours, nb\_remove arcs sont choisis al\'eatoirement puis supprim\'es.
\\

Tous les 15 tours, si le tours n'est pas un tour de suppression d'arc alors 
un noeud choisi al\'etoirement est retir\'e du mod\`ele.

\subsection{M\'ethode de test: testScenarioID()}

Tant que le nombre de tour est inf\'erieur au nombre de tour maximal:
\\

Si tour modulo 8 est \'egal \'a 0 et qu'il y'a au moins un arc dans le 
mod\'ele, on teste si l'arc \`a retirer est pr\'esent, on le retire.
On teste alors s'il a bien \'et\'e retir\'e, c'est \`a dire qu'il n'est 
plus pr\'esent dans la liste des arcs du mod\`ele et la liste des ses noeuds.
\\

Si tour modulo 15 est \'egal \'a 0 et qu'il y'a au moins un noeud dans le 
mod\`ele, on cr\'ee 2 listes d'arc afin de copier les listes d'arc sortant et 
entrant du noeud \`a supprimer.
On supprime le noeud choisi, puis on teste si le noeud est encore pr\'esent 
dans le mod\`ele et si les listes d'arc du mod\`ele et des noeuds voisins ont 
bien \'et\'e mises \`a jour.
\\

Sinon, si l'arc peut \^etre ajout\'e on teste s'il a correctement \'et\'e ajout\'e et 
s'il ne peut \^etre ajout\'e on v\'erifie qu'il n'est pas dans le mod\`ele.
\\

On incr\'emente "tour" de 1.

\subsection{Unicit\'e des identifiants}

Afin d'effectuer les tests sur les identifiants, une liste des identifiants 
(listOfId) a \'et\'e ajout\'ee \`a la classe Model du package coloane.model.
Ainsi, \`a chaque ajout d'un arc ou d'un noeud, son identifiant sera stock\'e 
dans cette liste et \`a chaque retrait d'un arc ou d'un noeud, son identifiant 
sera retir\'e de la liste.
\\

Dans la m\'ethode switchArcOk(), avant chaque ajout, on teste si l'id de 
valeur maxId+1 est pr\'esent dans la liste des identifiants, s'il ne l'est pas 
, on ajoute l'arc ou le noeud.
Apr\`es l'ajout, on teste si l'id de l'\'el\'ement ajout\'e est bien 
dans la liste des identifiants et que c'est le id maximum (getMaxId()).
\\

\section{Conclusion}

D'apr\`es les tests, avant les modifications apport\'ees \`a la classe Model,
 il \'etait possible d'ajouter un arc dont les noeuds cible et source n'etaient
pas pr\'esents dans le mod\`ele.
\\

Les tests prennent en compte qu'un arc peut avoir pour cible et source un 
m\^eme noeud.
\\

Dans l'ensemble les tests ont \'et\'e concluant sur 10, 20, 100, 500, 1000 et 
10000 tours, les identifiants sont uniques pour chaque \'el\'em\'ents mais 
limit\'ees \`a la valeur maximale d'un int et l'ajout et la 
suppression de noeuds et d'arcs se d\'eroulent correctement.

\end{document}

