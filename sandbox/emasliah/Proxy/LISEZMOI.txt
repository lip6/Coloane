Documentation du Proxy Transparent Java
=======================================

Copyright (C) 1999 by Didier Frick (http://www.dfr.ch/)
Ce logiciel est fourni aux conditions de la license générale publique GNU (GPL)
(http://www.gnu.org/copyleft/gpl.html).
Modifié par Eric Masliah - LiP6 / MoVe

1) Introduction
------------

Ce logiciel implémente un proxy transparent en Java. Un proxy
transparent est un logiciel capable de rediriger les connections TCP
arrivant sur un port donné d'une certaine machine vers un port
différent d'une autre machine (ou de la même machine).

Ceci peut être utile si vous utilisez des applets Java et que vous
voulez que ces applets puissent se connecter à une machine autre que
le serveur HTTP dont elles proviennent.

Il y a d'autres façons d'arriver au même résultat, mais toutes ces
alternatives exigent une intervention plus ou moins complexe sur le
client qui exécute les applets.

ATTENTION: 
Suite à un bug dans la version actuelle (pre-2) du JDK1.2
sous Linux, ce proxy ne fonctionne actuellement pas dans cet
environnement. Ce problème à été signalé à l'équipe Java-Linux.
Si vous parvenez à utiliser ce proxy dans cet environnement, merci
de m'en informer afin que je puisse mettre à jour cette documentation.

2) Démarrer le proxy comme une application Java
--------------------------------------------

java emasliah.proxy.ProxyThread <paramètres>

- Voir le paragraphe suivant pour la syntaxe des paramètres.

3) Paramètres
----------

Le proxy peut être démarré avec trois formes de paramètres différentes:

- Avec un seul paramètre: le paramètre est le nom complet d'un fichier de propriétés contenant les
informations de configuration. Voir le paragraphe suivant pour la structure de ce fichier.

- Avec trois paramètres, les paramètres ont les significations suivantes:

- Premier paramètre:   le numéro de port local où le proxy doit "écouter"
- Second paramètre:    le nom DNS ou l'adresse IP à laquelle les connections sont renvoyées
- Troisième paramètre: le numéro de port auquel les connections sont renvoyées

- Exemple: 

2000 test.xy.net 80 

renvoie les connections sur le port local 2000 vers le port 80 de la machine test.xy.net

- Avec quatre paramètres, les paramètres ont les significations suivantes:
(Ceci n'est utile que si la machine a plusieurs interfaces et que vous voulez que le proxy
n'écoute que sur un seul de ces interfaces)

- Premier paramètre:   le nom DNS ou l'adresse IP de l'interface où le proxy doit "écouter"
- Second paramètre:    le numéro de port local où le proxy doit "écouter"
- Troisième paramètre: le nom DNS ou l'adresse IP à laquelle les connections sont renvoyées
- Quatrième paramètre: le numéro de port auquel les connections sont renvoyées

- Exemple:

server.yz.net 2000 test.xy.net 80

Renverra les connections sur le port 2000 de l'interface "server.yz.net" vers le port 80
de la machine "test.xy.net". Bien sûr, "server.yz.net" doit être l'adresse d'un interface
local à la machine où le proxy s'exécute.

4) Format du fichier de configuration
----------------------------------

En utilisant un fichier de configuration, un seul proxy peut rediriger les connections de
plusieurs ports en même temps.

Nous utiliserons le terme "instance du proxy" pour désigner un
proxy qui écoute sur un port spécifique.

Chaque instance du proxy définie dans le fichier de configuration aura un numéro, démarrant à 0.
Les instances suivantes auront des numéros croissants.

ATTENTION: Il ne doit pas y avoir de "trous" dans les numéros. Le
code arrête la lecture du fichier de configuration dès qu'il
rencontre un numéro non utilisé.

Le format général du fichier est celui d'un fichier de propriétés Java.

Pour l'instance numéro <XX>, les propriétés suivantes DOIVENT être définies:

proxy.<XX>.sourcePort     le numéro de port local où le proxy doit "écouter"
proxy.<XX>.destAddr       le nom DNS ou l'adresse IP à laquelle les connections sont renvoyées
proxy.<XX>.destPort       le numéro de port auquel les connections sont renvoyées

La propriété suivante PEUT être définie:
(Ceci n'est utile que si la machine a plusieurs interfaces et que vous voulez que le proxy
n'écoute que sur un seul de ces interfaces)

proxy.<XX>.sourceAddr     le nom DNS ou l'adresse IP de l'interface où le proxy doit "écouter"

Voici un example de fichier de configuration:

proxy.0.sourceAddr=localhost
proxy.0.sourcePort=2000
proxy.0.destAddr=test.xy.net
proxy.0.destPort=19
proxy.1.sourcePort=2001
proxy.1.destAddr=172.24.1.1
proxy.1.destPort=19

Cette configuration créera une instance du proxy qui redirige les connections sur le port 2000 de 
l'interface "localhost" vers le port 19 de la machine "test.xy.net", et une autre instance qui
redirigera les connections vers le port 2001 de n'importe quel interface local vers le port 19
de la machine 172.24.1.1.

5) Utilisation du proxy comme service Windows NT
   ---------------------------------------------

ATTENTION:
Ceci exige une machine avec Windows NT 4.0 et le service pack 3 ou supérieur.

- Installez le fichier ProxyService.EXE sur votre système.

- Installez le service en exécutant ProxyService.EXE avec l'option /INSTALL:

          ProxyService /INSTALL

- Ouvrez le panneau de configuration des services et sélectionnez le
  service "Java Transparent Proxy" dans la liste.

- Créez un fichier de configuration nommé "proxy.properties", au
  format décrit au point 4, et enregistrez-le dans le même répertoire
  que le programme ProxyService.EXE

- Si vous voulez contrôler manuellement le démarrage du service,
  utilisez les boutons "Démarrer" et "Arrêter" à droite de la liste.

- Si vous voulez que le service démarre automatiquement au démarrage
  du système, double-cliquez sur le service "Java Transparent Proxy"
  dans la liste, puis sélectionnez le type de démarrage "Automatique" et cliquez sur "OK"

- Pour désinstaller le service, démarrez ProxyService.EXE avec l'option /UNINSTALL.

- Cette version génère des évènements système pour tous ses messages.

7) Modifications et remarques
   --------------------------

Merci de me faire parvenir vos modifications et vos remarques à l'adresse suivante:

dfrick@dial.eunet.ch
